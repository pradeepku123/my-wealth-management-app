<div class="container-fluid">
  <div class="my-4">
    <h1 class="fw-bold mb-1">Asset Portfolio</h1>
    <p class="text-muted">Breakdown of your investments by category</p>
  </div>

  <!-- Consolidated View -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card border-0 shadow-lg overflow-hidden bg-white">
        <div class="card-body p-0">
          <div class="row g-0">
            <!-- Metrics Section -->
            <div class="col-lg-7 p-4 p-md-5 d-flex flex-column justify-content-center">

              <h4 class="fw-bold text-secondary text-uppercase mb-4" style="letter-spacing: 1px; font-size: 0.85rem;">
                Consolidated Portfolio</h4>

              <div class="mb-5">
                <div class="text-muted small text-uppercase fw-bold mb-1">Total Portfolio Value</div>
                <h1 class="display-3 fw-bold text-dark mb-0" style="letter-spacing: -2px;">₹{{ totalCurrentValue |
                  number:'1.0-0' }}</h1>
              </div>

              <div class="row g-4">
                <div class="col-md-6">
                  <div class="p-3 rounded-4 bg-light border border-light-subtle">
                    <div class="text-muted small text-uppercase fw-bold mb-1">Total Invested</div>
                    <h3 class="fw-bold text-dark mb-0">₹{{ totalInvested | number:'1.0-0' }}</h3>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="p-3 rounded-4 bg-light border border-light-subtle">
                    <div class="text-muted small text-uppercase fw-bold mb-1">Total Returns</div>
                    <div class="d-flex align-items-baseline">
                      <h3 class="fw-bold mb-0" [ngClass]="totalReturns >= 0 ? 'text-success' : 'text-danger'">
                        {{ totalReturns >= 0 ? '+' : '' }}₹{{ totalReturns | number:'1.0-0' }}
                      </h3>
                      <span class="ms-2 fw-bold px-2 py-1 rounded-pill small"
                        [ngClass]="totalReturns >= 0 ? 'bg-success-subtle text-success' : 'bg-danger-subtle text-danger'">
                        {{ totalReturnsPercentage | number:'1.2-2' }}%
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Chart Section -->
            <div
              class="col-lg-5 p-4 d-flex flex-column align-items-center justify-content-center bg-light border-start border-light-subtle">
              <div class="position-relative mb-4" style="width: 260px; height: 260px;">
                <svg viewBox="0 0 200 200" width="100%" height="100%"
                  style="filter: drop-shadow(0 4px 6px rgba(0,0,0,0.05));">
                  <g transform="rotate(-90 100 100)">
                    @for (asset of assetBreakdown; track asset.investment_type; let i = $index) {
                    <path [attr.d]="getPieChartPath(i)" [attr.fill]="getChartColor(asset.investment_type)"
                      stroke="white" stroke-width="2" class="chart-segment">
                      <title>{{ getAssetTypeLabel(asset.investment_type) }}: ₹{{ asset.total_current | number }}</title>
                    </path>
                    }
                  </g>
                  <!-- Center Hole for Donut Effect -->
                  <circle cx="100" cy="100" r="65" fill="#f8f9fa" />
                  <text x="100" y="100" text-anchor="middle" dy="0.3em" font-size="10" font-weight="bold" fill="#6c757d"
                    letter-spacing="1px">
                    ASSETS
                  </text>
                </svg>
              </div>

              <!-- Legend -->
              <div class="d-flex flex-wrap justify-content-center gap-2 px-3">
                @for (asset of assetBreakdown; track asset.investment_type) {
                <div
                  class="d-flex align-items-center bg-white border border-light-subtle rounded-pill px-2 py-1 shadow-sm">
                  <span class="d-inline-block rounded-circle me-2"
                    [style.background-color]="getChartColor(asset.investment_type)"
                    style="width: 8px; height: 8px;"></span>
                  <span class="text-secondary small fw-medium" style="font-size: 0.75rem;">{{
                    getAssetTypeLabel(asset.investment_type) }}</span>
                </div>
                }
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row g-4">
    @for (asset of assetBreakdown; track asset.investment_type) {
    <div class="col-md-6 col-lg-4 col-xl-3">
      <div class="card h-100 border-0 shadow-sm hover-lift" (click)="navigateToPortfolio(asset.investment_type)"
        style="cursor: pointer;">
        <div class="card-body p-4">
          <div class="d-flex align-items-center mb-3">
            <div class="icon-box rounded-3 d-flex align-items-center justify-content-center me-3" [ngClass]="{
                     'bg-primary-subtle text-primary': asset.investment_type === 'mutual_fund',
                     'bg-success-subtle text-success': asset.investment_type === 'ppf' || asset.investment_type === 'epf',
                     'bg-warning-subtle text-warning-emphasis': asset.investment_type === 'fd',
                     'bg-info-subtle text-info-emphasis': asset.investment_type === 'nps',
                     'bg-secondary-subtle text-secondary': !['mutual_fund','ppf','epf','fd','nps'].includes(asset.investment_type)
                   }" style="width: 48px; height: 48px;">
              <i class="bi fs-4" [ngClass]="{
                     'bi-graph-up': asset.investment_type === 'mutual_fund',
                     'bi-piggy-bank': asset.investment_type === 'ppf' || asset.investment_type === 'epf',
                     'bi-cash-stack': asset.investment_type === 'fd',
                     'bi-umbrella': asset.investment_type === 'nps',
                     'bi-wallet2': !['mutual_fund','ppf','epf','fd','nps'].includes(asset.investment_type)
                   }"></i>
            </div>
            <h5 class="card-title fw-bold mb-0">{{ getAssetTypeLabel(asset.investment_type) }}</h5>
          </div>

          <div class="mb-3">
            <small class="text-muted text-uppercase fw-bold" style="font-size: 0.7rem;">Current Value</small>
            <h3 class="fw-bold mb-0">₹{{ asset.total_current | number:'1.2-2' }}</h3>
          </div>

          <div class="d-flex justify-content-between align-items-end border-top pt-3">
            <div>
              <div class="small text-muted">Invested</div>
              <div class="fw-semibold">₹{{ asset.total_invested | number:'1.2-2' }}</div>
            </div>
            <div class="text-end">
              <div class="small text-muted">Returns</div>
              <div class="fw-bold" [ngClass]="asset.total_returns >= 0 ? 'text-success' : 'text-danger'">
                {{ asset.return_percentage | number:'1.2-2' }}%
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    }
  </div>
</div>